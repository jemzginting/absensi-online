<div class="">
    <div class="page-title">
        <div class="title_left">
        </div>
    </div>

    <div class="clearfix"></div>

    <div class="row">
        <div class="col-md-12 col-sm-12 col-xs-12">
            <div class="x_panel">
                <div class="x_title">
                    <h2>Jadwal Kerja</h2>
                    <ul class="nav navbar-right panel_toolbox">
                        <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                aria-expanded="false"><i class="fa fa-wrench"></i></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="#">Settings 1</a>
                                </li>
                                <li><a href="#">Settings 2</a>
                                </li>
                            </ul>
                        </li>
                        <li><a class="close-link"><i class="fa fa-close"></i></a>
                        </li>
                    </ul>
                    <div class="clearfix"></div>
                </div>

                <div class="x_content">
                    <div class="" role="tabpanel" data-example-id="togglable-tabs">
                        <ul id="myTab" class="nav nav-tabs bar_tabs" role="tablist">
                            <li role="presentation" class="active"><a href="#tab_content1" id="home-tab" role="tab"
                                    data-toggle="tab" aria-expanded="true">Regu 1</a></li>
                            <li role="presentation" class=""><a href="#tab_content2" role="tab" id="profile-tab"
                                    data-toggle="tab" aria-expanded="false">Regu 2</a></li>
                            <li role="presentation" class=""><a href="#tab_content3" id="profile-tab" role="tab"
                                    data-toggle="tab" aria-expanded="false">Regu 3</a></li>
                            <li role="presentation" class=""><a href="#tab_content3" role="tab" id="profile-tab"
                                    data-toggle="tab" aria-expanded="false">Regu 4</a></li>
                        </ul>
                        <div id="myTabContent" class="tab-content">
                            <!-- start Setting Regu 1-->
                            <div role="tabpanel" class="tab-pane fade active in" id="tab_content1"
                                aria-labelledby="home-tab">
                                <div class="x_content">
                                    <button type="button" id="hapus_row" name="btn_delall"
                                        class="btn btn-danger btn_delall">Deleted Selected Items</button>
                                    <br>
                                    <div class="table responsive">
                                        <table id="datashiftx" class="table table-striped table-bordered">
                                            <thead>
                                                <tr>
                                                    <th width="2%">
                                                        <center>
                                                            <input type="checkbox" id="checkall">
                                                        </center>
                                                    </th>
                                                    <th width="2%">
                                                        <center>No</center>
                                                    </th>
                                                    <th width="20%">
                                                        <center>Nama Pegawai</center>
                                                    </th>
                                                    <th>
                                                        <center>NIP</center>
                                                    </th>
                                                    <th width="10%">
                                                        <center>Jam Masuk Kerja</center>
                                                    </th>
                                                    <th width="10%">
                                                        <center>Jam Pulang Kerja</center>
                                                    </th>
                                                    <th width="7%">
                                                        <center>Regu</center>
                                                    </th>
                                                    <th width="15%">
                                                        <center>Keterangan</center>
                                                    </th>
                                                    <th>
                                                        <center>Status</center>
                                                    </th>
                                                    <th>
                                                        <center>Aksi</center>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- end Setting Regu 1-->
                            <!-- start Setting Regu 2-->
                            <div role="tabpanel" class="tab-pane fade" id="tab_content2" aria-labelledby="home-tab">
                                <div class="x_content">
                                <button type="button" id="hapus_row" name="btn_delall"
                                        class="btn btn-danger btn_delall">Deleted Selected Items</button>
                                    <br>
                                    <div class="table responsive">
                                        <table id="regu2" class="table table-striped table-bordered">
                                            <thead>
                                                <tr>
                                                    <th width="2%">
                                                        <center>
                                                            <input type="checkbox" id="checkall">
                                                        </center>
                                                    </th>
                                                    <th width="2%">
                                                        <center>No</center>
                                                    </th>
                                                    <th width="20%">
                                                        <center>Nama Pegawai</center>
                                                    </th>
                                                    <th>
                                                        <center>NIP</center>
                                                    </th>
                                                    <th width="10%">
                                                        <center>Jam Masuk Kerja</center>
                                                    </th>
                                                    <th width="10%">
                                                        <center>Jam Pulang Kerja</center>
                                                    </th>
                                                    <th width="7%">
                                                        <center>Regu</center>
                                                    </th>
                                                    <th width="15%">
                                                        <center>Keterangan</center>
                                                    </th>
                                                    <th>
                                                        <center>Status</center>
                                                    </th>
                                                    <th>
                                                        <center>Aksi</center>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- end Setting Regu 2-->
                            <!-- start Setting Regu 3-->
                            <div role="tabpanel" class="tab-pane fade" id="tab_content3" aria-labelledby="home-tab">
                                <div class="x_content">
                                <button type="button" id="hapus_row" name="btn_delall"
                                        class="btn btn-danger btn_delall">Deleted Selected Items</button>
                                    <br>
                                    <div class="table responsive">
                                        <table id="regu3" class="table table-striped table-bordered">
                                            <thead>
                                                <tr>
                                                    <th width="2%">
                                                        <center>
                                                            <input type="checkbox" id="checkall">
                                                        </center>
                                                    </th>
                                                    <th width="2%">
                                                        <center>No</center>
                                                    </th>
                                                    <th width="20%">
                                                        <center>Nama Pegawai</center>
                                                    </th>
                                                    <th>
                                                        <center>NIP</center>
                                                    </th>
                                                    <th width="10%">
                                                        <center>Jam Masuk Kerja</center>
                                                    </th>
                                                    <th width="10%">
                                                        <center>Jam Pulang Kerja</center>
                                                    </th>
                                                    <th width="7%">
                                                        <center>Regu</center>
                                                    </th>
                                                    <th width="15%">
                                                        <center>Keterangan</center>
                                                    </th>
                                                    <th>
                                                        <center>Status</center>
                                                    </th>
                                                    <th>
                                                        <center>Aksi</center>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- end Setting Regu 3-->
                            <!-- start Setting Regu 4-->
                            <div role="tabpanel" class="tab-pane fade" id="tab_content4" aria-labelledby="home-tab">
                                <div class="x_content">
                                <button type="button" id="hapus_row" name="btn_delall"
                                        class="btn btn-danger btn_delall">Deleted Selected Items</button>
                                    <br>
                                    <div class="table responsive">
                                        <table id="regu4" class="table table-striped table-bordered">
                                            <thead>
                                                <tr>
                                                    <th width="2%">
                                                        <center>
                                                            <input type="checkbox" id="checkall">
                                                        </center>
                                                    </th>
                                                    <th width="2%">
                                                        <center>No</center>
                                                    </th>
                                                    <th width="20%">
                                                        <center>Nama Pegawai</center>
                                                    </th>
                                                    <th>
                                                        <center>NIP</center>
                                                    </th>
                                                    <th width="10%">
                                                        <center>Jam Masuk Kerja</center>
                                                    </th>
                                                    <th width="10%">
                                                        <center>Jam Pulang Kerja</center>
                                                    </th>
                                                    <th width="7%">
                                                        <center>Regu</center>
                                                    </th>
                                                    <th width="15%">
                                                        <center>Keterangan</center>
                                                    </th>
                                                    <th>
                                                        <center>Status</center>
                                                    </th>
                                                    <th>
                                                        <center>Aksi</center>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- end Setting Regu 4-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" language="javascript">
    $('#datashiftx').ready(function () {
        var c = $('#datashiftx').DataTable();

        function load_data() {
            $.ajax({

                url: '<?php echo site_url('
                PengelolaController / get_all_shift ') ?>',
                dataType: "JSON",
                success: function (data) {
                    c.clear().draw();

                    for (var i = 0; i < data.length; i++) {
                        var check = '<input type="checkbox" name="btn_deleteall" id="' + data[i][
                            'badgenumber'
                        ] + '" class="checkitem">';
                        var btn1 = '<button type="button" name="btn_edit" id="' + data[i][
                                'id_shift'] +
                            '" class="btn btn-xs btn-primary btn_edit"><span class="fa fa-edit fa-2x"></span></button>';
                        var btn2 = '<button type="button" name="btn_delete" id="' + data[i][
                                'badgenumber'
                            ] +
                            '" class="btn btn-xs btn-danger btn_delete"><span class="fa fa-trash fa-2x"></span></button>';

                        if (data[i]['status'] == "fullday") {
                            status = "Full Day";
                        } else if (data[i]['status'] == "enam_hari") {
                            status = "Enam Hari";
                        } else if (data[i]['status'] == "double_shift") {
                            status = "Double Shift";
                        } else {
                            status = data[i]['status'];
                        }

                        c.row.add([
                            "<center>" + check + "</center>",
                            "<center>" + [i + 1] + "</center>",
                            "<center>" + data[i]['nama_user'] + "</center>",
                            "<center>" + data[i]['badgenumber'] + "</center>",
                            "<center>" + data[i]['jam_masuk'] + "</center>",
                            "<center>" + data[i]['jam_keluar'] + "</center>",
                            "<center>" + [i + 1] + "</center>",
                            "<center>" + data[i]['keterangan'] + "</center>",
                            "<center>" + status + "</center>",
                            "<center>" + btn1 + btn2 + "</center>",
                        ]).draw();
                    }
                }
            });
            $('#checkall').change(function () {
                $(".checkitem").prop("checked", $(this).prop("checked"))
            });
        }

        load_data();

        $(document).on("click", ".btn_delall", function () {
            $('#hapus_row').click(function () {
                var checkbox = $('.checkitem:checked');
                if (checkbox.length > 0) {

                    var badgenumber = [];
                    $(checkbox).each(function () {
                        badgenumber.push($(this).attr('id'));
                    });
                    swal({
                            title: "Hapus Shift",
                            text: "Apakah anda yakin akan menghapus data shift ini?",
                            type: "warning",
                            showCancelButton: true,
                            confirmButtonText: "Hapus",
                            closeOnConfirm: true,
                        },
                        function () {
                            var join = badgenumber.join(",");
                            $.ajax({
                                url: "<?php echo site_url('PengelolaController/all_hapus_shift'); ?>",
                                method: "POST",
                                data: "ids=" + join,
                                success: function (data) {
                                    //oad_data();
                                    swal({
                                        title: "Data Berhasil Dihapus",
                                        text: "Data sudah terhapus",
                                        type: "success",
                                    });
                                    //load_data();
                                    window.location.reload(true);

                                }
                            });
                        });
                } else {
                    swal({
                        title: "Tidak ada data yang dihapus",
                        type: "warning",
                    });
                }
            })
        });

        $(document).on("click", ".btn_delete", function () {
            var badgenumber = $(this).attr('id');
            swal({
                    title: "Hapus Shift",
                    text: "Apakah anda yakin akan menghapus data shift ini?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonText: "Hapus",
                    closeOnConfirm: true,
                },
                function () {
                    $.ajax({
                        url: "<?php echo site_url('PengelolaController/hapus_shift'); ?>",
                        method: "POST",
                        data: {
                            badgenumber: badgenumber
                        },
                        success: function (data) {
                            load_data();
                            swal({
                                title: 'Hapus Jam Kerja Berhasil',
                                text: '',
                                type: 'success'
                            });
                        }
                    });
                });
        });

        $('#btn-simpan').click(function () {
            var update_data = $('#form-edit').serialize();
            console.log(update_data);
            $.ajax({
                url: "<?php echo base_url(); ?>index.php/PengelolaController/update_detail_shift",
                type: "POST",
                data: update_data,

                //  dataType : 'json', //already make by datatype                 
                success: function (data) {
                    console.log("data");
                    load_data();
                    $('#edit-modal').modal('hide');
                    load_data();
                    swal({
                        title: 'Edit Jam Shift Berhasil',
                        text: '',
                        type: 'success'
                    });

                },
                error: function (status) {
                    swal({
                        title: 'Edit Jam Shift Gagal',
                        text: '',
                        type: 'danger'
                    });
                }
            });
        });

        $('#btn-simpan_sekolah').click(function () {
            var update_data = $('#form-edit').serialize();
            console.log(update_data);
            $.ajax({
                url: "<?php echo base_url(); ?>index.php/PengelolaController/update_jam_sekolah",
                type: "POST",
                data: update_data,

                //  dataType : 'json', //already make by datatype                 
                success: function (data) {
                    console.log("data");
                    load_data();
                    $('#edit-modal').modal('hide');
                    load_data();
                    swal({
                        title: 'Edit Jam Shift Berhasil',
                        text: '',
                        type: 'success'
                    });
                },
                error: function (status) {
                    swal({
                        title: 'Edit Jam Shift Gagal',
                        text: '',
                        type: 'danger'
                    });
                }
            });
        });


    });
</script>

<script>
    $('#datashiftx').on('click', '.btn_edit', function () {
        var id_shift = $(this).attr("id");

        //console.log(badgenumber);
        $.ajax({
            url: "<?php echo base_url(); ?>index.php/PengelolaController/get_detail_shift",
            type: "GET",
            data: {
                id_shift: id_shift

            },
            success: function (ajaxData) {
                var result = JSON.parse(ajaxData);
                /*  
                  $('#id_shift-modal').val(id_shift);
                  $('#name-modal').val(result[0]['name']);
                  $('#start_date-modal').datepicker(result[0]['start_date']);
                  $('#end_date-modal').val(result[0]['end_date']);
                  $('#jam_masuk-modal').val(result[0]['jam_masuk']);
                  $('#jam_keluar-modal').val(result[0]['jam_keluar']);
                  $('#status-modal').val(result[0]['status']);
                */
                $('#id_shift-modal').val(id_shift);
                $('[name="name-modal"]').val(result[0]['name']);
                $('[name="start_date-modal"]').val(result[0]['start_date']);
                $('[name="end_date-modal"]').val(result[0]['end_date']);
                $('[name="jam_masuk-modal"]').val(result[0]['jam_masuk']);
                $('[name="jam_keluar-modal"]').val(result[0]['jam_keluar']);
                $('[name="status-modal"]').val(result[0]['status']);

                $('#edit-modal').modal('show');
            },
            error: function (status) {

            }
        });
    });
</script>

<script>
    $('#datetimepicker1').datetimepicker({
        format: 'HH:mm'
    });
    $('#datetimepicker2').datetimepicker({
        format: 'HH:mm'
    });

    $('#mulaiedit').datetimepicker({
        format: 'YYYY-MM-DD'
    });

    $('#sampaiedit').datetimepicker({
        format: 'YYYY-MM-DD'
    });
</script>